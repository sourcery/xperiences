{% extends 'base.html' %}

{% load x_tags %}

{% block content %}
<div class="space30"></div>
<div class="column span9">
	<div class="listings-container">
		<h1>Your experiences</h1>
		<ul class="listings"></ul>
	</div><!-- closing listings-container -->
</div>
{% include "merchants/command_bar.html" %}
{% endblock %}


{% block hidden_templates %}
<script type='text/x_jquery_tempaltes' id='experience_item_template'>
    <li class="listing panel">
        <h4 class="listing-title">
            <a title="{% t_var title %}" href="{% t_url merchant_edit_experience slug_id %}"> {% t_var title %} </a>
		</h4>	
		<a class="listing-image" title=" {% t_var title %}" href="{% t_url merchant_edit_experience slug_id %}">
            <img width="150" height="70" alt="{% t_var title %}" {% t_if photo1 %}src="{% t_var photo1.url %}"{% t_endif %}>
        </a>
		<!--        <div id="thumb-details">
            <p class="listing-merchant">
                <a title="{% t_var merchant.name %}" href=""> {% t_var merchant.name %}, {% t_var merchant.city %} {% t_var merchant.state %}</a>
            </p>
            <p class="listing-price">
                <span class="currency-symbol">$</span>
                {% t_var price %}
                <span class="currency-code"></span>
            </p>
        </div>
		Active: <input type=checkbox value='{% t_var is_active %}' {% t_if is_active %}checked='checked'{% t_endif %} onchange='update_status(this,"{% t_var id %}");' />-->
		
		<div class="listing-item-short">
			<div>Money earned</div>
			<div class="listing-value">$100</div>
		</div>
		<div class="listing-item-short">
			<div>Requests</div>
			<div class="listing-value">10</div>
		</div>
		<div class="listing-item-short">
			<div>Page views</div>
			<div class="listing-value">200</div>
		</div>
		<div class="listing-actions">
			<a href="{% t_url merchant_edit_experience slug_id %}"><button class="btn">edit</button></a>
            <a href="{% t_url experience_profile slug_id %}"><button class="btn">view</button></a>
			{% t_if is_active %}
			<button id="deactivate_{% t_var slug_id %}" class="activate btn" onclick='activate_experience(this,"{% t_var slug_id %}");'>deactivate</button>
			{% t_else %}
			<button id="activate_{% t_var slug_id %}" class="activate btn submit" onclick='activate_experience(this,"{% t_var slug_id %}");'>activate</button>
			{% t_endif %}
		</div>
    </li>
</script>
{% endblock %}


{% block extra_scripts %}
<script type='text/javascript' >
var _merchant_id = '{{ merchant }}';
function get_experiences(params) {
    params = params || {};
    $.get('/api/experiences/json', params, render);
}


function render(data) {
    var items = $("#experience_item_template").tmpl(data);
    items.appendTo("ul.listings");
}


$(document).ready(function(){
		get_experiences({"of_merchant": true });
});

function activate_experience(sender,slug_id)
{
    var $this = $(sender);
    var is_activated = $this.text() != "activate";
    update_state(slug_id,is_activated);
    $this.text(is_activated ? "activate" : "deactivate");
    $this.toggleClass("submit");
}

function update_state(slug_id,is_activated)
{
        var is_active = !is_activated;
        $.ajax( { url : '/api/experiences/json', data : { is_active : is_active, slug_id:slug_id } , type : 'PUT'});
}
</script>
{% endblock %}
