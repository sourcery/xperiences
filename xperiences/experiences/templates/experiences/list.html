<!-- THIS IS THE HOME PAGE INDEX.HTML SAVED IN THE EXPERIENCES APP -->
{% extends "base.html" %}

{% load x_tags %}

{% block extra_head %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}css/front-page.css" />
{% endblock %}

{% block content %}
        <div class="command-bar-container">
        </div>
        <div class="two-col-left-narrow-float">
            <div id="search-left-bar" class="panel dark">
                <h4>Search results</h4>
                <input type="text" class="shorter" id='keywords_field' /> near <input type="text" class="short" id="address_field" />
                <input type='hidden' id="lat_field" name='lat' />
                <input type='hidden' id="lng_field" name='lng' />

                <button class="margin-top-10" onclick='search_again();' >search again</button>
            </div>
            <div id="map-bar" class="panel">
                This is where the map goes
            </div>
            <div id="filter-bar" class="panel">
                <h4>Filter by</h4>
                {% for category in categories %}
                <div><input type="checkbox" name="{{ category.id }}" checked='checked'>{{ category }}</div>
                {% endfor %}
            </div>
        </div>
        <div class="two-col-right-wide">
<!--            <h2>There are 32 listings</h2> -->
            <div class="page-nav">
                <ul>
                    <li>&lt;</li>
                    <li class="active">1</li>
                    <li>2</li> 
                    <li>3</li> 
                    <li>4</li> 
                    <li>&gt;</li>
                </ul>
            </div>
        </div>
        <div class="image-grid"></div>
    </div>

    <div style='display:none;'>
        <script type='text/x_jquery_templates' id='test-template'>
            <div class="search-result">
                <img alt=" {% t_var title %} "{% t_if photo1 %}src="{% t_var photo1.url %}"{% t_endif %} />
                <div class="price">${% t_var price %}</div>
                <a title="{% t_var title %}" href="/experiences/{% t_var slug_id %}"><h4>{% t_var title %}</h4></a>
                <a title="{% t_var merchant.name %}" href=""><div class="secondary">{% t_var merchant.name %}{% t_if merchant.city %}, {% t_var merchant.city %} {% t_var merchant.state %} {% t_endif %}</div></a>
            </div>
         </script>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script type='text/javascript' src='{{ MEDIA_URL }}js/front_page.js'></script>
    <script>
    function render(data,meta) {
        var tcrw = $(".two-col-right-wide").empty();
        if(meta)
            tcrw.append(create_nav(meta));
        for (var i = 0; i < data.length; i++) {
            $("#test-template").tmpl(data[i]).appendTo(tcrw);
        }
    }

    function create_nav(meta)
    {
        if(meta.pages <= 1)
            return '';
        var ul = $('<ul></ul');// $('<div class="page-nav"><ul></ul></div>');
        if(meta.has_previous)
            ul.append('<li to_page="' + (Number(meta.page)-1) + '">&lt;</li>');
        for(var i=0; i<meta.pages; i++)
        {
            if(i==meta.page)
                ul.append('<li class="active">' + (i+1) + '</li>');
            else
                ul.append('<li to_page="' + i + '">' + (i+1) + '</li>');
        }
        if(meta.has_next)
            ul.append('<li to_page="' + Number(meta.page)+1 + '">&gt;</li>');
        $('li',ul).click(function()
        {
            if(!$(this).has('to_page'))
                return;
            last_params['offset'] = Number($(this).attr('to_page'))*Number(meta.limit);
            get_experiences(last_params);
        });
        return $('<div class="page-nav"></div>').append(ul);
    }
    function search_again()
    {
        var lat = $('#lat_field').val();
        var lng = $('#lng_field').val();
        var keywords = $('#keywords_field').val();
        var categories = '';
        $('#filter-bar input[type=checkbox]').each(function()
        {
           var cb = $(this);
            if(cb.is(':checked'))
            {
                if( categories != '')
                    categories += ',';
                categories += cb.attr('name');
            }
        });
        if(categories == '')
            return;
        var params = {
          lat:lat,lng:lng,keywords:keywords,category:categories
        };
        get_experiences(params);
    }

</script>
{% endblock %}
